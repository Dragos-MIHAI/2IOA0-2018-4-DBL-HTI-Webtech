<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.png" />
<title>Visualize: Force Directed Graph</title>
 
<style>
body {
        background-image: url(" ");
} 
 
</style>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<body id="myPage">


 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 <script src="https://d3js.org/d3.v4.min.js"></script>
 <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
 
<body>
 <script>
  let input = ''
  let items = ''
  let nodes = [];
  let verticesNames = [];
  let verticesIndex = []; // We will use this later to not have to search for each index separately. This will make the running time shorter
  let links = [];

  axios
  .get(
    "https://raw.githubusercontent.com/Dragos-MIHAI/2IOA0-2018-4-DBL-HTI-Webtech/master/GephiMatrix_co-authorship.csv"
  )
  .then(function(result) {
    input = result.data;
    input = input.slice(1,input.length);
    items = input.split(/[\s;]+/);
    console.log(items[0])
    manipulate()
    dThree()
  });
  
  function manipulate() {
   let dictionaryWord = 0;
   dictionaryWord = {"id": items[0]}
   nodes.push(dictionaryWord);
   verticesNames.push(items[0]);
   verticesIndex[items[0]] = 0;
   let index = 1;
   while (items[index] != items[0]) {
       dictionaryWord = {"id": items[index]};
       nodes.push(dictionaryWord);
       verticesNames.push(items[index]);
       verticesIndex[items[index]] = index;
       index++;
    console.log(JSON.stringify(nodes))
   }

   let vertex = items[index];
   index++;
   while (index < items.length) {
       for (let i = 0; i < nodes.length; i++) {
           if (items[index] != 0) {
               dictionaryWord = {"source": vertex, "target": verticesNames[i], "value": items[index]};
               links.push(dictionaryWord);
           }
           index++;
       }
       vertex = items[index];
       index++;

   }
   console.log(JSON.stringify(links))
  } 
   
   
function dThree() {
  var graph = d3.select("body")
                .append("svg");
  
  //properties of the object            
  var w = 1920,
      h = 1080;
  
  //giving the graph the properties
  graph.attr("width", w)
       .attr("height", h);
       
  
   //var nodes = [{"id":"Marco"},{"id":"Lucas"},{"id":"Dragos"}];
                
   //var links = [{"source":"Marco","target":"Marco","value":"1"},{"source":"Marco","target":"Lucas","value":"0.6947"},{"source":"Marco","target":"Dragos","value":"0.3967"},{"source":"Lucas","target":"Marco","value":"0.6947"},{"source":"Lucas","target":"Lucas","value":"1"},{"source":"Lucas","target":"Dragos","value":"0.2850"},{"source":"Dragos","target":"Marco","value":"0.3967"},{"source":"Dragos","target":"Lucas","value":"0.2850"},{"source":"Dragos","target":"Dragos","value":"1"}];
            

  //simulation for force directed       
  var simulation = d3.forceSimulation(nodes)
        //adding link between 2 ID's
        .force("link", d3.forceLink(links).id(d => d.id))
        .force("charge", d3.forceManyBody())
        //making a center for the graph
        .force("center", d3.forceCenter(w / 2, h / 2));
         

  //adding links to the graph     
  var link = graph.append("g")
        //adds stroke with #colour
        .attr("stroke", "#999")
        .attr("stroke-opacity", 0.8)
        .selectAll("line")
        .data(links)
        .enter()
        .append("line")
        //width of a line based on its value in the data
        .attr("stroke-width", d => ((d.value)));
               
                 

  //adding the nodes to the graph 
  var node = graph.append("g")
        .attr("stroke", "#fff#FF6347")
        //width of the circle surrounding the node
        .attr("stroke-width", 2.0)
        .selectAll("circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("r", 2)
        .attr("fill", "green")
        //drag function
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));
 
   //selecting data + drawing                 
  simulation
        .nodes(nodes)
        .on("tick", tick);


  simulation.force("link")
        .links(links);     

  //assigning name to each node      
  node.append("title")
        .text(d => d.id);

  //drawin the graph on the right place
  function tick() {
      link
          .attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });
          
      node
        .attr("cx", function(d) { return d.x;})
        .attr("cy", function(d) { return d.y;})
  }


  //movement
  function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.2).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

  function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
  }

  function dragended(d) {
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
  }
}

 </script>
</body>
</html>
