<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cooccurrence Matrix</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
  
</head>

<style>
body {
        background-image: url("In website images/black.jpg ");
}

</style>


<body>

	<!-- Navigation bar -->
<div class="w3-top">
        <div class="w3-bar w3-theme-d2 w3-left-align">
         <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-hover-white w3-theme-d2" href="javascript:void(0);" onclick="openNav()"><i class="fa fa-bars"></i></a>
         <a href="index.html" class="w3-bar-item w3-button w3-teal"><i class="fa fa-home w3-margin-right"></i>VizYou</a>
         <a href="home.html" class="w3-bar-item w3-button w3-hide-small w3-hover-blue">Home</a>
         
         
           <div class="w3-dropdown-hover w3-hide-small">
           <button class="w3-button" title="Notifications">Visualization <i class="fa fa-caret-down"></i></button>     
           <div class="w3-dropdown-content w3-card-4 w3-bar-block">
              <a href="insert.html" class="w3-bar-item w3-button">Insert Data</a>
            <a href="force_directed.html" class="w3-bar-item w3-button">Force-Directed</a> 
            <a href="node-link 2.html" class="w3-bar-item w3-button"> Radial</a>
            <a href="hierar.html" class="w3-bar-item w3-button">Hierarchical Diagram</a>
            <a href="convertprove.html" class="w3-bar-item w3-button">Adjacency Matrix</a>
            
            <a href="convertprove.html" class="w3-bar-item w3-button">Visualize II</a>
          
           
           
             
           </div>
         </div>

         <div class="w3-dropdown-hover w3-hide-small">
          <button class="w3-button" title="Notifications">Split Screen <i class="fa fa-caret-down"></i></button> 
          <div class="w3-dropdown-content w3-card-4 w3-bar-block">
         <a href="force_matrix.html" class="w3-bar-item w3-button ">Force-Directed + Matrix</a>
         <a href="hierar_matrix.html" class="w3-bar-item w3-button ">Hierarchical + Matrix</a>
         <a href="radial_matrix.html" class="w3-bar-item w3-button ">Radial + Matrix</a>
         <a href="all_matrix.html" class="w3-bar-item w3-button ">All + Matrix</a>

          </div>
          </div>


         <a href="team.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Team</a>
         <a href="pricing.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Price</a>
         <a href="Contact.html" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Contact</a>

         <div class="w3-dropdown-hover w3-hide-small">
          <button class="w3-button" title="Notifications">Old Work <i class="fa fa-caret-down"></i></button> 
          <div class="w3-dropdown-content w3-card-4 w3-bar-block">
            <a href="vizualize.html" class="w3-bar-item w3-button">Another type of Matrix</a>
         <a href="hierar_matrix.html" class="w3-bar-item w3-button ">Hierarchical + Matrix</a>
         <a href="radial_matrix.html" class="w3-bar-item w3-button ">Radial + Matrix</a>
         <a href="all_matrix.html" class="w3-bar-item w3-button ">All + Matrix</a>

          </div>
          </div>
         
         
         <a href="#" class="w3-bar-item w3-button w3-hide-small w3-right w3-hover-teal" title="Search"><i class="fa fa-search"></i></a>
        </div>
    
        <!-- Navbar on small screens -->
      <div id="navDemo" class="w3-bar-block w3-theme-d2 w3-hide w3-hide-large w3-hide-medium">
          <a href="#team" class="w3-bar-item w3-button">Team</a>
          <a href="#work" class="w3-bar-item w3-button">Work</a>
          <a href="#pricing" class="w3-bar-item w3-button">Price</a>
          <a href="#contact" class="w3-bar-item w3-button">Contact</a>
          <a href="#" class="w3-bar-item w3-button">Search</a>
        </div>
      </div>
    
    
        
	  
	  


	<div style="display:inline-block;" id="legend"></div>
	
    <div style="display:block; float:left" id="block"></div>

	

	  
				<!-- <aside>
			 <p>Order: <select id="order">
			   <option class="top-level-option" value="name">by Name</option>
			   <option class="top-level-option" value="count">by Number of links</option>
			   <option class="top-level-option" value="group">by Group</option>
			   <option class="top-level-option" value="distance">by Distance to...</option>
			 </select>
			 </aside> -->

		 <p>Order: <select id="d3-dropdown">
			   <option value="first">Frequency</option>
			   <option value="second">Alphabetical</option>
			   <option value="third">Reverse Alphabetical</option>
			   <option value="forth">Clustering</option>
				 <option value="fifth">Random</option>
			 </select>
		 <p id="selected-dropdown"></p>


	<script src="https://d3js.org/d3-color.v1.min.js"></script>
	<script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
	<script src="https://d3js.org/d3-ease.v1.min.js"></script>
	<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
	<script src="https://d3js.org/d3-selection.v1.min.js"></script>
	<script src="https://d3js.org/d3-timer.v1.min.js"></script>
	<script src="https://d3js.org/d3-transition.v1.min.js"></script>
	<script src="https://d3js.org/d3-drag.v1.min.js"></script>
	<script src="https://d3js.org/d3-zoom.v1.min.js"></script>
	<script>
		var zoom = d3.zoom();
	</script>
	<script>



	// Script for side navigation
    function w3_open() {
      var x = document.getElementById("mySidebar");
      x.style.width = "300px";
      x.style.paddingTop = "10%";
      x.style.display = "block";
    }
    
    // Close side navigation
    function w3_close() {
      document.getElementById("mySidebar").style.display = "none";
    }
    
    // Used to toggle the menu on smaller screens when clicking on the menu button
    function openNav() {
      var x = document.getElementById("navDemo");
      if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
      } else { 
        x.className = x.className.replace(" w3-show", "");
      }
    }

	//button event
		d3.select("#selected-dropdown");

		d3.select("select")
		  .on("change",function(d){
		    var selected = d3.select("#d3-dropdown").node().value;
		    console.log( selected );
		    d3.select("#selected-dropdown").text(selected);
		})


		let vertices = []; // The JSON object as {"id": 'vertexName'}
		let names = []; // We want to be able to get the vertexName by means of its index
		let verticesIndex = {}; // We will use this later to not have to search for each index separately. This will make the running time shorter
		let vertex = "";
		let links = [];
		let dict = {} // An object as {'vertexName' : frequency}
		let frequencies = [] // The order of vertices by frequency
		let frequencyMatrixColumns = [] // The matrix with columns AND rows ordered by frequency
		let matrix = [];
		axios
		.get(
		  "https://raw.githubusercontent.com/Dragos-MIHAI/2IOA0-2018-4-DBL-HTI-Webtech/master/matrixdata"
		)
		.then(function(result) {
		  	input = result.data;
		  	input = input.slice(1,input.length);
		  	items = input.split(/[\s;]+/);
		  	createData();
			Information({
		        block : '#block',
        		data     : matrix,
		        names    : names,
    		    colour_1 : '#FFFFFF', //colour_1 to colour_2 is the colour range
        		colour_2 : '#A60000',
				highlight_cell_on_hover: true,
        		highlight_cell_color: '#2ecc71'
   			});
			Information(options);
		});
		function transpose(m) {
  			return m[0].map((_, i) => m.map(row => row[i]));
		}
		function createData() { // In this function, we get the vertices, their names and their indexes. We then create a JSON file in which the links are per vertex ordered by name
			let nodes = [];
			let dictionaryWord = {}; // This object keeps getting added to vertices as {"id": 'vertexName'}, as a JSON file
		    dictionaryWord = {"id": items[0]} // This will be the object we keep adding first to vertices, then with a slight change to links
		    vertices.push(dictionaryWord);
		    nodes.push(items[0]);
		    verticesIndex[items[0]] = 0;
		    let index = 1; // This was necessary because our loop invariant wouldn't hold, since the first item, items[0], obviously equals items[0]
		    while (items[index] != items[0]) {
		        dictionaryWord = {"id": items[index]};
		        vertices.push(dictionaryWord);
		        nodes.push(items[index]);
		        index++;
		    }
		    //console.log(JSON.stringify(vertices)); // Uncomment for debugging
		    vertex = items[index]; // Will contain the name of the source vertex of the links untill we went past all its adjacent vertices
		    index++;
			let row = []
			let connected = false;
			let vertexIndex = 0;
		    while (index < items.length) {
				row = []
				connected = false;
		        for (let i = 0; i < vertices.length; i++) {
		            if (items[index] != 0) { // Checks if the weight is not 0 so that there is actually an edge
		                dictionaryWord = {"source": vertex, "target": nodes[i], "value": items[index]}; // JSON file for links, containing source, target (from, to) and value (weight)
						links.push(dictionaryWord);
						connected = true
		            }
		            row.push(items[index]);
		            index++;
		        }
		        vertex = items[index]; // After vertices.length steps, we checked all possible adjacent vertices and thus we can take the next vertex, which is now at items[index]
				if (connected) {
					matrix.push(row);
				} else {
					delete nodes[vertexIndex];
				}
				vertexIndex++;
		        index++;
			}
			console.log(nodes);
			let matrixColumns = [];
			matrixColumns = transpose(matrix);
			for (let i = nodes.length - 1; i > -1; i--) {
				if (nodes[i] === undefined) {
					matrixColumns.splice(i, 1);
				}
			}
			matrix = transpose(matrixColumns);
			let names = nodes.filter(function (el) {
  				return el != null;
			});
			console.log(names);
			for (let i = 0; i < names.length; i++) {
				verticesIndex[names[i]] = i;
			}
		    console.log(JSON.stringify(matrix)); // Uncomment for debugging
		}
	/*
    Information({
        block : '#block',
        data     : matrix,
        names    : names,
        colour_1 : '#FFFFFF', //colour_1 to colour_2 is the colour range
        colour_2 : '#A60000',
		highlight_cell_on_hover: true,
        highlight_cell_color: '#2ecc71'
    });
	*/
		function Information(options) {
			var margin = {top: 50, right: 50, bottom: 100, left: 100},
			    width = 500,
			    height = 500,
			    data = options.data,
			    block = options.block,
			    namesData = options.names,
			    colour1 = options.colour_1,
			    colour2 = options.colour_2,
					highlightCellOnHover = options.highlight_cell_on_hover,
		      highlightCellColor = options.highlight_cell_color;
			var widthLegend = 100;
		//get the minimum and maximum value of the data
		    var maxValue = d3.max(data, function(layer) { return d3.max(layer, function(d) { return d; }); });
		    var minValue = d3.min(data, function(layer) { return d3.min(layer, function(d) { return d; }); });
			var numrows = data.length;
			var numcols = data[0].length;
		//matrix size
			var svg = d3.select(block).append("svg").style("margin-left","600px")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				.call(d3.zoom().on("zoom", function () {
    				svg.attr("transform", d3.event.transform)
 				}));

		//matrix outline
			var background = svg.append("rect")
			    .style("stroke", "#CA5959")
			    .style("stroke-width", "5px")
			    .attr("width", width)
			    .attr("height", height);
			var x = d3.scale.ordinal()
			    .domain(d3.range(numcols))
			    .rangeBands([0, width]);
			var y = d3.scale.ordinal()
			    .domain(d3.range(numrows))
			    .rangeBands([0, height]);
		//scale the colour of boxes with mininum and maximum values
			var colorMap = d3.scale.linear()
			    .domain([minValue,maxValue])
			    .range([colour1, colour2]);
			var row = svg.selectAll(".row")
			    .data(data)
			  	.enter().append("g")
			    .attr("class", "row")
			    .attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });
			var cell = row.selectAll(".cell")
			    .data(function(d) { return d; })
					.enter().append("g")
			    .attr("class", "cell")
			    .attr("transform", function(d, i) { return "translate(" + x(i) + ", 0)"; });
			cell.append('rect')
			    .attr("width", x.rangeBand())
			    .attr("height", y.rangeBand())
			    .style("stroke-width", 0);
//highlight cell
					if(highlightCellOnHover){
				cell
				.on("mouseover", function(d) {
						d3.select(this).style("fill", highlightCellColor);
				})
				.on("mouseout", function() {
						d3.select(this).style("fill", colorMap);
				});
		}
			row.selectAll(".cell")
			    .data(function(d, i) { return data[i]; })
			    .style("fill", colorMap);
			var names = svg.append('g')
				.attr('class', "names");
			var columnLabels = names.selectAll(".column-label")
			    .data(namesData)
			    .enter().append("g")
			    .attr("class", "column-label")
			    .attr("transform", function(d, i) { return "translate(" + x(i) + "," + height + ")"; });
			columnLabels.append("line")
			    .attr("x1", x.rangeBand() / 2)
			    .attr("x2", x.rangeBand() / 2)
			    .attr("y1", 0)
			    .attr("y2", 5);
			columnLabels.append("text")
			    .attr("x", -8)
			    .attr("y", y.rangeBand() / 2)
			    .attr("dy", ".82em")
			    .attr("text-anchor", "end")
			    .text(function(d, i) { return d; })
					.attr("transform", "rotate(-45)");
			var rowLabels = names.selectAll(".row-label")
			    .data(namesData)
			  .enter().append("g")
			    .attr("class", "row-label")
			    .attr("transform", function(d, i) { return "translate(" + 0 + "," + y(i) + ")"; });
			rowLabels.append("line")
			    .attr("x1", 0)
			    .attr("x2", -5)
			    .attr("y1", y.rangeBand() / 2)
			    .attr("y2", y.rangeBand() / 2);
			rowLabels.append("text")
			    .attr("x", -8)
			    .attr("y", y.rangeBand() / 2)
			    .attr("dy", ".32em")
			    .attr("text-anchor", "end")
			    .text(function(d, i) { return d; });
		}
</script>

</body>
